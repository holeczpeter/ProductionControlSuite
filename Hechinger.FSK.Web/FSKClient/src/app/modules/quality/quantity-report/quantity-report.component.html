<div class="container-fluid">
  <app-title class="flex-title-item" [title]="title"></app-title>
  <form [formGroup]="formGroup" *ngIf="formGroup">
    <div class="row pt-2">
      <mat-form-field class="col">
        <mat-select [formControlName]="'product'" [placeholder]="'productName' | translate" #productSelect required panelClass="myPanelClass">
          <mat-option>
            <ngx-mat-select-search [formControl]="productFilterCtrl"></ngx-mat-select-search>
          </mat-option>
          <mat-option *ngFor="let option of filteredProducts | async" [value]="option">
            {{option.code}} - {{ (languageService.getCurrentLanguage() | async) == 'hu' ? option.name : option.translatedName}}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="formGroup.get('product')?.hasError('required')">
          {{'productName'| translate}} {{'required' | translate}}
        </mat-error>
      </mat-form-field>
    </div>
  </form>
  <app-interval-view [intervalOptions]="intervalOptions"></app-interval-view>
  <div class="example-container" #tableDataView>
    <table *ngIf="dataSource.data && dataSource.data.length > 0; else noData"
           mat-table
           [dataSource]="dataSource">
      <ng-container matColumnDef="header-date-row-start" sticky>
        <th mat-header-cell *matHeaderCellDef class="th-align-right">
          {{ 'date' | translate}}
        </th>
      </ng-container>
      <ng-container matColumnDef="header-date-quantity-row-start" sticky>
        <th mat-header-cell *matHeaderCellDef class="th-align-right">
          {{ 'quantity' | translate}}
        </th>
      </ng-container>
      <ng-container matColumnDef="header-shift-row-start" sticky>
        <th mat-header-cell *matHeaderCellDef class="th-align-right">
          {{ 'shiftName' | translate}}
        </th>
      </ng-container>
      <ng-container matColumnDef="header-shift-quantity-row-start" sticky>
        <th mat-header-cell *matHeaderCellDef class="th-align-right">
          {{ 'quantity' | translate}}
        </th>
      </ng-container>
      <ng-container *ngFor="let key of displayedHeaders.columnIds; let i = index">
        <ng-container [ngSwitch]="key">
          
          <ng-container *ngSwitchCase="'defect'" [ngTemplateOutlet]="defecttemplate" [ngTemplateOutletContext]="{ $implicit: key }"></ng-container>
          <ng-container *ngSwitchDefault [ngTemplateOutlet]="defaultTemplate" [ngTemplateOutletContext]="{ $implicit: key }"></ng-container>
        </ng-container>
        <ng-template #defecttemplate let key>
          <ng-container [matColumnDef]="key" sticky>
            <th mat-header-cell *matHeaderCellDef class="defect-header">
              {{ 'defectName' | translate }}
            </th>
            <td mat-cell *matCellDef="let element">
              {{(languageService.getCurrentLanguage() | async) == 'hu' ?  element[key].name  :  element[key].translatedName }}
            </td>
          </ng-container>
        </ng-template>
        <ng-template #defaultTemplate let key>
          <ng-container [matColumnDef]="key">
            <th mat-header-cell *matHeaderCellDef class="category-header th-align-center"
                [style.--background-color]="getCategory(displayedHeaders.columnIds[i])">
              {{ displayedHeaders.columnIds[i] | category }}
            </th>
            <td mat-cell *matCellDef="let element" align="center">
              {{ element[key].value }}
            </td>
          </ng-container>
        </ng-template>
      </ng-container>
      <ng-container *ngFor="let key of displayedHeaders.sumIds; let i = index">
        <ng-container [matColumnDef]="key">
          <th mat-header-cell *matHeaderCellDef class="category-header th-align-center"
              [style.--background-color]="getCategory(displayedHeaders.columnIds[i])">
            {{ displayedHeaders.sumIds[i]  | sumCategory }}
          </th>
          <td mat-cell *matCellDef="let element" align="center">
            {{ element[key] }}
          </td>
        </ng-container>
      </ng-container>
      <ng-container *ngFor="let key of displayedHeaders.days; let i = index">
        <ng-container [matColumnDef]="key.id">
          <th mat-header-cell *matHeaderCellDef [attr.colspan]="getColSpan()" class="th-align-center">
            {{(languageService.getCurrentLanguage() | async) == 'hu' ? ( displayedHeaders.days[i].id | dateWithName:'hu') : ( displayedHeaders.days[i].id | dateWithName:'de')}} <br />
            {{(languageService.getCurrentLanguage() | async) == 'hu' ? ( displayedHeaders.days[i].id | date:'YYYY.MM.dd') : ( displayedHeaders.days[i].id | date:'dd.MM.YYYY')}} <br />
          </th>
        </ng-container>
      </ng-container>
      <ng-container *ngFor="let key of displayedHeaders.daysQuantity; let i = index">
        <ng-container [matColumnDef]="key">
          <th mat-header-cell *matHeaderCellDef [attr.colspan]="getColSpan()" class="th-align-center">
            {{displayedHeaders.days[i].value}}
          </th>
        </ng-container>
      </ng-container>
      <ng-container *ngFor="let key of displayedHeaders.shifts; let i = index">
        <ng-container [matColumnDef]="key.id">
          <th mat-header-cell *matHeaderCellDef [attr.colspan]="3" class="th-align-center">
            {{(languageService.getCurrentLanguage() | async) == 'hu' ? ( displayedHeaders.shifts[i].id | shiftName: 'hu': shifts) : ( displayedHeaders.shifts[i].id | shiftName: 'de':shifts)}}

          </th>
        </ng-container>
      </ng-container>
      <ng-container *ngFor="let key of displayedHeaders.shiftsQuantity; let i = index">
        <ng-container [matColumnDef]="key">
          <th mat-header-cell *matHeaderCellDef [attr.colspan]="3" class="th-align-center">
            {{displayedHeaders.shifts[i].value}}
          </th>
        </ng-container>
      </ng-container>
      <ng-container matColumnDef="header-row-empty-end">
        <th mat-header-cell *matHeaderCellDef class="th-align-center" [attr.colspan]="3">
        </th>
      </ng-container>
      <ng-container matColumnDef="header-row-sum-all-end">
        <th mat-header-cell *matHeaderCellDef class="th-align-center" [attr.colspan]="3">
          {{getSumQuantity()}}
        </th>
      </ng-container>
      <ng-container matColumnDef="header-row-sum-end">
        <th mat-header-cell *matHeaderCellDef class="th-align-center" [attr.colspan]="3">
          {{'sum' | translate}}
        </th>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="['header-date-row-start'].concat(dayColumnNames).concat(['header-row-sum-end']); sticky: true"></tr>
      <tr mat-header-row *matHeaderRowDef="['header-date-quantity-row-start'].concat(displayedHeaders.daysQuantity).concat(['header-row-empty-end']); sticky: true" class="data-row"></tr>
      <tr mat-header-row *matHeaderRowDef="['header-shift-row-start'].concat(shiftColumnNames).concat(['header-row-empty-end']); sticky: true"></tr>
      <tr mat-header-row *matHeaderRowDef="['header-shift-quantity-row-start'].concat(displayedHeaders.shiftsQuantity).concat(['header-row-sum-all-end']); sticky: true" class="data-row"></tr>
      <tr mat-header-row *matHeaderRowDef="displayedHeaders.columnIds.concat(displayedHeaders.sumIds); sticky: true" class="data-row"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedHeaders.columnIds.concat(displayedHeaders.sumIds);"></tr>
      <ng-container matColumnDef="groupHeader">
        <td colspan="999" mat-cell *matCellDef="let groupBy"><strong>
  {{(languageService.getCurrentLanguage() | async) == 'hu' ? (groupBy.initial.operationName) : (groupBy.initial.operationTranslatedName)}} - {{groupBy.initial.operationId}}
  
</strong></td>
      </ng-container>

      <tr mat-row *matRowDef="let row; columns: ['groupHeader']; when: isGroup"> </tr>

    </table>
    <!--<mat-paginator [pageSize]="pageSize"
                   [pageSizeOptions]="pageSizeOptions"
                   showFirstLastButtons class="mat-paginator-sticky"></mat-paginator>-->
    <ng-template #noData>
      <div class="container-fluid pt-3 pb-3">
        <div class="row justify-content-center align-content-center">
          <div>
            Nincs megjelenítendő adat
          </div>
        </div>
      </div>
    </ng-template>
  </div>
</div>
